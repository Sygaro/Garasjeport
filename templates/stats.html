
{% extends "base.html" %}
{% block content %}
<div class="container mt-4">
  <h2 class="mb-4">ðŸ“ˆ Statistikk for porter</h2>

  <div class="row g-4 mb-5">
    {% for port in stats %}
    <div class="col-md-6">
      <div class="card border-primary">
        <div class="card-header bg-primary text-white d-flex justify-content-between align-items-center">
          <span>ðŸšª {{ port.name | capitalize }}</span>
          <div>
            <a href="/port/open/{{ port.name }}" class="btn btn-sm btn-success me-2">Ã…pne</a>
            <a href="/port/close/{{ port.name }}" class="btn btn-sm btn-danger">Lukk</a>
          </div>
        </div>
        <div class="card-body">
          <p><strong>Status:</strong> 
            {% if port.status == "Ã¥pen" %}
              <span class="badge bg-success">Ã…pen</span>
            {% elif port.status == "lukket" %}
              <span class="badge bg-secondary">Lukket</span>
            {% elif port.status == "sensorfeil" %}
              <span class="badge bg-danger">Sensorfeil!</span>
            {% else %}
              <span class="badge bg-warning text-dark">Ukjent</span>
            {% endif %}
          </p>
          <p><strong>Siste endring:</strong> {{ port.last_change }}</p>
          <p><strong>Ã…pnet totalt:</strong> {{ port.open_count }} ganger</p>
          <p><strong>Totalt Ã¥pen tid:</strong> {{ port.total_open_time }} min</p>
        </div>
      </div>
    </div>
    {% endfor %}
  </div>

  <h4 class="mb-4">ðŸ“Š Ã…pninger siste 7 dager</h4>
  <canvas id="openChart" height="150"></canvas>
</div>
{% endblock %}

{% block scripts %}
{{ super() }}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
const ctx = document.getElementById('openChart').getContext('2d');
const chartData = {
  labels: {{ days | default([]) | tojson }},
  datasets: [
    {% for port, entries in history.items() %}
    {
      label: '{{ port }}',
      data: [
        {% for d in days %}
          {{ entries.get(d, 0) | default(0) }}{% if not loop.last %}, {% endif %}
        {% endfor %}
      ],
      fill: false,
      borderColor: '{{ loop.cycle("red", "blue", "green", "orange", "purple") }}',
      tension: 0.3
    },
    {% endfor %}
  ]
};

new Chart(ctx, {
  type: 'line',
  data: chartData,
  options: {
    responsive: true,
    plugins: {
      legend: { position: 'top' },
      title: {
        display: true,
        text: 'Antall Ã¥pninger per dag'
      }
    }
  }
});
</script>
{% endblock %}
