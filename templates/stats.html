{% extends "base.html" %}

{% block content %}
<div class="container mt-4">
  <h2>Systemstatus</h2>

  <div class="row mt-4">
    <div class="col-md-6">
      <div class="card text-center">
        <div class="card-header bg-primary text-white">
          Port 1
        </div>
        <div class="card-body">
          <h5>Status: <span id="port1Status" class="badge bg-secondary">Laster...</span></h5>
          <button class="btn btn-outline-primary mt-2" onclick="triggerPort('port1')">Send Puls</button>
        </div>
      </div>
    </div>

    <div class="col-md-6">
      <div class="card text-center">
        <div class="card-header bg-success text-white">
          Port 2
        </div>
        <div class="card-body">
          <h5>Status: <span id="port2Status" class="badge bg-secondary">Laster...</span></h5>
          <button class="btn btn-outline-success mt-2" onclick="triggerPort('port2')">Send Puls</button>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
function fetchStatus(port) {
  fetch(`/api/status/${port}`)
    .then(response => response.json())
    .then(data => {
      const statusBadge = document.getElementById(`${port}Status`);
      statusBadge.textContent = data.status;

      // Fargestatus
      const colorMap = {
        open: 'bg-success',
        closed: 'bg-primary',
        moving: 'bg-warning text-dark',
        partial_open: 'bg-warning text-dark',
        sensor_error: 'bg-danger',
        unknown: 'bg-secondary'
      };

      statusBadge.className = `badge ${colorMap[data.status] || 'bg-secondary'}`;
    });
}

function updateAllStatuses() {
  fetchStatus('port1');
  fetchStatus('port2');
}

function triggerPort(port) {
  fetch(`/api/pulse/${port}`, {
    method: 'POST',
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ source: "frontend" })
  }).then(res => {
    updateAllStatuses();
  });
}

setInterval(updateAllStatuses, 5000); // 5 sek intervall
window.addEventListener('DOMContentLoaded', updateAllStatuses);
</script>
{% endblock %}
