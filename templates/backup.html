
{% extends 'base.html' %}
{% block content %}

<h3>💾 Konfigurasjonsbackup</h3>
<a href="/create-backup" class="btn btn-outline-secondary btn-sm mb-3">
  📤 Ta ny backup av config.json
</a>
<a href="/admin/backup/compare" class="btn btn-outline-primary btn-sm mb-3">
  🆚 Sammenlign to backupfiler
</a>

<h2>💾 Backupfiler</h2>
<p>Her kan du vise, laste ned eller gjenopprette konfigurasjonsfiler.</p>

<form method="POST" action="/delete-backup/multiple">
<table class="table table-sm table-hover table-bordered bg-body-tertiary shadow-sm">
  <thead class="table-light">
    <tr>
      <th><input type="checkbox" onclick="toggleAll(this)"></th>
      <th>🗂️ Filnavn</th>
      <th>Dato</th>
      <th>Handlinger</th>
    </tr>
  </thead>
  <tbody>
    {% for f in backups %}
    <tr>
      <td><input type="checkbox" name="selected_files" value="{{ f }}"></td>
      <td>{{ f }}</td>
      <td>
        {% set parts = f.replace('.json','').split('_') %}
        {% if parts|length >= 3 %}
          {% set date = parts[-2] %}
          {% set time = parts[-1] %}
          {{ date[:4] }}-{{ date[4:6] }}-{{ date[6:8] }} {{ time[:2] }}:{{ time[2:4] }}:{{ time[4:6] }}
        {% else %}
          <span class="text-muted">Ukjent format</span>
        {% endif %}
      </td>
      <td class="d-flex gap-2 flex-wrap">
        <a class="btn btn-sm btn-info" href="/admin/backup/view/{{ f }}">🧾 Vis</a>
        <a href="/download-backup/{{ f }}" class="btn btn-sm btn-outline-primary">⬇️ Last ned</a>
        <a class="btn btn-sm btn-warning" href="/restore/{{ f }}"
           onclick="return confirm('Er du sikker på at du vil gjenopprette denne backupen?')">♻️ Gjenopprett</a>
        <a class="btn btn-sm btn-outline-danger" href="/delete-backup/{{ f }}"
           onclick="return confirm('Slett permanent?')">🗑️ Slett</a>
      </td>
    </tr>
    {% endfor %}
  </tbody>
</table>

<div class="mt-3 d-flex justify-content-between align-items-center">
  <button class="btn btn-danger btn-sm" onclick="return confirm('Slett valgte filer?')">🗑️ Slett valgte</button>
  <div class="text-muted small">
    Automatisk sletting: eldre enn <strong>{{ retention_days }}</strong> dager
  </div>
</div>
</form>

<script>
function toggleAll(source) {
  document.querySelectorAll('input[name="selected_files"]').forEach(cb => cb.checked = source.checked);
}
</script>

<a href="/admin/settings" class="btn btn-secondary btn-sm mt-4">🔙 Tilbake til innstillinger</a>
{% endblock %}
